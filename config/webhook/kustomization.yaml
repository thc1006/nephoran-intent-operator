# Kustomization file for webhook deployment
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: nephoran-webhook-deployment
  namespace: nephoran-system

resources:
- serviceaccount.yaml
- service.yaml
- deployment.yaml
- mutating-webhook.yaml
- validating-webhook.yaml
- rbac-patch.yaml

labels:
- pairs:
    app.kubernetes.io/name: nephoran-intent-operator
    app.kubernetes.io/component: webhook
    app.kubernetes.io/part-of: nephoran-intent-operator
    app.kubernetes.io/version: v1.0.0

# Certificate configuration
configMapGenerator:
- name: webhook-config
  literals:
  - WEBHOOK_TLS_MIN_VERSION=1.2
  - WEBHOOK_CIPHER_SUITES=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
  - WEBHOOK_TIMEOUT=30s
  - VALIDATION_LOG_LEVEL=info

# Namespace creation
namespace: nephoran-system

# Image settings
images:
- name: webhook-manager
  newName: nephoran/webhook-manager
  newTag: latest

# Replace placeholders in webhook configurations
replacements:
- source:
    kind: Service
    name: webhook-manager
    fieldPath: metadata.namespace
  targets:
  - select:
      kind: MutatingWebhookConfiguration
    fieldPaths:
    - webhooks.[name=mnetworkintent.nephoran.io].clientConfig.service.namespace
  - select:
      kind: ValidatingWebhookConfiguration
    fieldPaths:
    - webhooks.[name=vnetworkintent.nephoran.io].clientConfig.service.namespace