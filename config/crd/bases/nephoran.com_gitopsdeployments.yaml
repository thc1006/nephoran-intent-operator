---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: gitopsdeployments.nephoran.com
spec:
  group: nephoran.com
  names:
    kind: GitOpsDeployment
    listKind: GitOpsDeploymentList
    plural: gitopsdeployments
    shortNames:
    - gd
    - gitopsdep
    singular: gitopsdeployment
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.parentIntentRef.name
      name: Parent Intent
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .spec.deploymentStrategy
      name: Strategy
      type: string
    - jsonPath: .status.gitCommit.hash
      name: Commit
      type: string
    - jsonPath: .status.syncStatus.status
      name: Sync Status
      type: string
    - jsonPath: .status.healthStatus.overallStatus
      name: Health
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: GitOpsDeployment is the Schema for the gitopsdeployments API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: GitOpsDeploymentSpec defines the desired state of GitOpsDeployment
            properties:
              autoSync:
                default: true
                description: AutoSync enables automatic synchronization
                type: boolean
              deploymentConfig:
                description: DeploymentConfig contains deployment-specific configuration
                properties:
                  dependencyChecks:
                    description: DependencyChecks defines dependency validation
                    properties:
                      dependencies:
                        description: Dependencies lists the dependencies to check
                        items:
                          description: ResourceDependency defines a resource dependency
                          properties:
                            apiVersion:
                              description: APIVersion of the dependency
                              type: string
                            condition:
                              description: Condition to check for the dependency
                              type: string
                            kind:
                              description: Kind of the dependency
                              type: string
                            name:
                              description: Name of the dependency
                              type: string
                            namespace:
                              description: Namespace of the dependency
                              type: string
                          required:
                          - apiVersion
                          - kind
                          - name
                          type: object
                        type: array
                      enabled:
                        default: true
                        description: Enabled determines if dependency checks are enabled
                        type: boolean
                      timeout:
                        default: 120s
                        description: Timeout for dependency checks
                        type: string
                    type: object
                  maxRetries:
                    default: 3
                    description: MaxRetries for failed operations
                    format: int32
                    maximum: 10
                    minimum: 0
                    type: integer
                  postDeploymentHooks:
                    description: PostDeploymentHooks defines post-deployment hooks
                    items:
                      description: DeploymentHook defines a deployment hook
                      properties:
                        configuration:
                          description: Configuration for the hook
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        name:
                          description: Name of the hook
                          type: string
                        onFailure:
                          default: abort
                          description: OnFailure defines behavior on hook failure
                          enum:
                          - abort
                          - continue
                          - retry
                          type: string
                        timeout:
                          default: 300s
                          description: Timeout for hook execution
                          type: string
                        type:
                          description: Type of hook (job, script, webhook, etc.)
                          type: string
                      required:
                      - configuration
                      - name
                      - type
                      type: object
                    type: array
                  preDeploymentHooks:
                    description: PreDeploymentHooks defines pre-deployment hooks
                    items:
                      description: DeploymentHook defines a deployment hook
                      properties:
                        configuration:
                          description: Configuration for the hook
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        name:
                          description: Name of the hook
                          type: string
                        onFailure:
                          default: abort
                          description: OnFailure defines behavior on hook failure
                          enum:
                          - abort
                          - continue
                          - retry
                          type: string
                        timeout:
                          default: 300s
                          description: Timeout for hook execution
                          type: string
                        type:
                          description: Type of hook (job, script, webhook, etc.)
                          type: string
                      required:
                      - configuration
                      - name
                      - type
                      type: object
                    type: array
                  resourceOrder:
                    description: ResourceOrder defines the order of resource deployment
                    items:
                      type: string
                    type: array
                  retryBackoff:
                    description: RetryBackoff defines retry backoff strategy
                    properties:
                      initialInterval:
                        default: 30s
                        description: InitialInterval for first retry
                        type: string
                      maxInterval:
                        default: 300s
                        description: MaxInterval caps the backoff interval
                        type: string
                      multiplier:
                        default: 2
                        description: Multiplier for exponential backoff
                        type: number
                    type: object
                  timeoutSeconds:
                    default: 600
                    description: Timeout for deployment operations
                    format: int32
                    maximum: 3600
                    minimum: 60
                    type: integer
                type: object
              deploymentStrategy:
                default: RollingUpdate
                description: DeploymentStrategy specifies the deployment strategy
                type: string
              gitRepository:
                description: GitRepository defines the Git repository configuration
                properties:
                  authorEmail:
                    default: noreply@nephoran.com
                    description: AuthorEmail for Git commits
                    type: string
                  authorName:
                    default: nephoran-intent-operator
                    description: AuthorName for Git commits
                    type: string
                  branch:
                    default: main
                    description: Branch to commit to
                    type: string
                  commitMessage:
                    description: CommitMessage template
                    type: string
                  path:
                    default: deployments
                    description: Path within the repository
                    type: string
                  provider:
                    default: generic
                    description: Provider specifies the Git provider
                    type: string
                  secretRef:
                    description: SecretRef for Git authentication
                    properties:
                      key:
                        description: Key within the secret
                        type: string
                      name:
                        description: Name of the secret
                        type: string
                      namespace:
                        description: Namespace of the secret (optional, defaults to
                          same namespace as AuditTrail)
                        type: string
                    required:
                    - name
                    type: object
                  signCommits:
                    default: false
                    description: SignCommits enables commit signing
                    type: boolean
                  url:
                    description: URL of the Git repository
                    type: string
                required:
                - url
                type: object
              healthChecks:
                description: HealthChecks defines health check configuration
                properties:
                  checkInterval:
                    default: 30s
                    description: CheckInterval defines how often to check health
                    type: string
                  checks:
                    description: Checks defines specific health checks
                    items:
                      description: HealthCheck defines a specific health check
                      properties:
                        configuration:
                          description: Configuration for the health check
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        name:
                          description: Name of the health check
                          type: string
                        resource:
                          description: Resource to check
                          properties:
                            apiVersion:
                              description: APIVersion of the resource
                              type: string
                            kind:
                              description: Kind of the resource
                              type: string
                            name:
                              description: Name of the resource
                              type: string
                            namespace:
                              description: Namespace of the resource
                              type: string
                            uid:
                              description: UID of the resource
                              type: string
                          required:
                          - apiVersion
                          - kind
                          - name
                          type: object
                        type:
                          description: Type of health check (readiness, liveness,
                            custom)
                          type: string
                      required:
                      - name
                      - resource
                      - type
                      type: object
                    type: array
                  enabled:
                    default: true
                    description: Enabled determines if health checks are enabled
                    type: boolean
                  timeout:
                    default: 300s
                    description: Timeout for health checks
                    type: string
                type: object
              manifestGenerationRef:
                description: ManifestGenerationRef references the ManifestGeneration
                  resource
                properties:
                  apiVersion:
                    description: APIVersion of the referent
                    type: string
                  fieldPath:
                    description: FieldPath refers to a field within the object
                    type: string
                  kind:
                    description: Kind of the referent
                    type: string
                  name:
                    description: Name of the referent
                    type: string
                  namespace:
                    description: Namespace of the referent; only applicable for namespaced
                      resources
                    type: string
                  resourceVersion:
                    description: ResourceVersion of the referent
                    type: string
                  uid:
                    description: UID of the referent
                    type: string
                required:
                - apiVersion
                - kind
                - name
                type: object
              manifests:
                additionalProperties:
                  type: string
                description: Manifests contains the manifests to deploy
                type: object
              parentIntentRef:
                description: ParentIntentRef references the parent NetworkIntent
                properties:
                  apiVersion:
                    description: APIVersion of the referent
                    type: string
                  fieldPath:
                    description: FieldPath refers to a field within the object
                    type: string
                  kind:
                    description: Kind of the referent
                    type: string
                  name:
                    description: Name of the referent
                    type: string
                  namespace:
                    description: Namespace of the referent; only applicable for namespaced
                      resources
                    type: string
                  resourceVersion:
                    description: ResourceVersion of the referent
                    type: string
                  uid:
                    description: UID of the referent
                    type: string
                required:
                - apiVersion
                - kind
                - name
                type: object
              priority:
                default: medium
                description: Priority defines deployment priority
                enum:
                - low
                - normal
                - medium
                - high
                - critical
                type: string
              rollbackConfig:
                description: RollbackConfig defines rollback configuration
                properties:
                  autoRollback:
                    default: false
                    description: AutoRollback enables automatic rollback on failure
                    type: boolean
                  enabled:
                    default: true
                    description: Enabled determines if rollback is enabled
                    type: boolean
                  strategy:
                    default: immediate
                    description: Strategy defines rollback strategy
                    enum:
                    - immediate
                    - gradual
                    - manual
                    type: string
                  timeout:
                    default: 300s
                    description: Timeout for rollback operations
                    type: string
                  trigger:
                    description: Trigger defines rollback triggers
                    properties:
                      errorThreshold:
                        description: ErrorThreshold defines error threshold for rollback
                        maximum: 100
                        minimum: 0
                        type: integer
                      onFailure:
                        default: true
                        description: OnFailure triggers rollback on deployment failure
                        type: boolean
                      onHealthCheckFailure:
                        default: false
                        description: OnHealthCheckFailure triggers rollback on health
                          check failure
                        type: boolean
                      timeWindow:
                        default: 5m
                        description: TimeWindow defines time window for error counting
                        type: string
                    type: object
                type: object
              syncPolicy:
                description: SyncPolicy defines synchronization policy
                properties:
                  automated:
                    description: Automated enables automated synchronization
                    properties:
                      allowEmpty:
                        default: false
                        description: AllowEmpty allows syncing with empty repository
                        type: boolean
                      prune:
                        default: false
                        description: Prune enables pruning of resources
                        type: boolean
                      selfHeal:
                        default: true
                        description: SelfHeal enables self-healing
                        type: boolean
                    type: object
                  retry:
                    description: Retry defines retry policy
                    properties:
                      backoff:
                        description: Backoff defines the retry backoff strategy
                        properties:
                          duration:
                            default: 5s
                            description: Duration is the initial backoff duration
                            type: string
                          factor:
                            default: 2
                            description: Factor is the backoff multiplier
                            format: int64
                            minimum: 1
                            type: integer
                          maxDuration:
                            default: 3m
                            description: MaxDuration caps the backoff duration
                            type: string
                        type: object
                      limit:
                        default: 5
                        description: Limit is the maximum number of retries
                        format: int64
                        maximum: 20
                        minimum: 0
                        type: integer
                    type: object
                  syncOptions:
                    description: SyncOptions defines sync options
                    items:
                      type: string
                    type: array
                type: object
              targetClusters:
                description: TargetClusters specifies the target clusters for deployment
                items:
                  description: TargetCluster defines a target cluster for deployment
                  properties:
                    config:
                      description: Config contains cluster-specific configuration
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    labels:
                      additionalProperties:
                        type: string
                      description: Labels for cluster identification
                      type: object
                    name:
                      description: Name of the cluster
                      type: string
                    namespace:
                      description: Namespace for deployment in the cluster
                      type: string
                    priority:
                      description: Priority for deployment order
                      maximum: 10
                      minimum: 1
                      type: integer
                    secretRef:
                      description: SecretRef for cluster authentication
                      properties:
                        key:
                          description: Key within the secret
                          type: string
                        name:
                          description: Name of the secret
                          type: string
                        namespace:
                          description: Namespace of the secret (optional, defaults
                            to same namespace as AuditTrail)
                          type: string
                      required:
                      - name
                      type: object
                    server:
                      description: Server URL of the cluster
                      type: string
                  required:
                  - name
                  type: object
                type: array
            required:
            - gitRepository
            - manifests
            - parentIntentRef
            type: object
          status:
            description: GitOpsDeploymentStatus defines the observed state of GitOpsDeployment
            properties:
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              deploymentCompletionTime:
                description: DeploymentCompletionTime indicates when deployment completed
                format: date-time
                type: string
              deploymentDuration:
                description: DeploymentDuration represents total deployment time
                type: string
              deploymentStartTime:
                description: DeploymentStartTime indicates when deployment started
                format: date-time
                type: string
              deploymentStatus:
                description: DeploymentStatus contains deployment status per cluster
                items:
                  description: ClusterDeploymentStatus contains deployment status
                    for a cluster
                  properties:
                    clusterName:
                      description: ClusterName is the name of the cluster
                      type: string
                    deployedResources:
                      description: DeployedResources lists deployed resources
                      items:
                        description: ResourceReference represents a reference to a
                          Kubernetes resource
                        properties:
                          apiVersion:
                            description: APIVersion of the resource
                            type: string
                          kind:
                            description: Kind of the resource
                            type: string
                          name:
                            description: Name of the resource
                            type: string
                          namespace:
                            description: Namespace of the resource
                            type: string
                          uid:
                            description: UID of the resource
                            type: string
                        required:
                        - apiVersion
                        - kind
                        - name
                        type: object
                      type: array
                    failedResources:
                      description: FailedResources lists failed resources
                      items:
                        description: ResourceReference represents a reference to a
                          Kubernetes resource
                        properties:
                          apiVersion:
                            description: APIVersion of the resource
                            type: string
                          kind:
                            description: Kind of the resource
                            type: string
                          name:
                            description: Name of the resource
                            type: string
                          namespace:
                            description: Namespace of the resource
                            type: string
                          uid:
                            description: UID of the resource
                            type: string
                        required:
                        - apiVersion
                        - kind
                        - name
                        type: object
                      type: array
                    lastUpdateTime:
                      description: LastUpdateTime is the last update time
                      format: date-time
                      type: string
                    message:
                      description: Message contains status message
                      type: string
                    status:
                      description: Status is the deployment status
                      type: string
                  required:
                  - clusterName
                  - status
                  type: object
                type: array
              gitCommit:
                description: GitCommit contains Git commit information
                properties:
                  author:
                    description: Author is the commit author
                    type: string
                  branch:
                    description: Branch is the target branch
                    type: string
                  files:
                    description: Files lists the committed files
                    items:
                      type: string
                    type: array
                  hash:
                    description: Hash is the Git commit hash
                    type: string
                  message:
                    description: Message is the commit message
                    type: string
                  timestamp:
                    description: Timestamp is the commit timestamp
                    format: date-time
                    type: string
                  url:
                    description: URL is the commit URL
                    type: string
                required:
                - author
                - branch
                - hash
                - message
                - timestamp
                type: object
              healthStatus:
                description: HealthStatus contains health check results
                properties:
                  checkResults:
                    description: CheckResults contains individual check results
                    items:
                      description: HealthCheckResult contains result of a health check
                      properties:
                        duration:
                          description: Duration is the check duration
                          type: string
                        lastCheckTime:
                          description: LastCheckTime is the last check time
                          format: date-time
                          type: string
                        message:
                          description: Message contains check result message
                          type: string
                        name:
                          description: Name of the health check
                          type: string
                        status:
                          description: Status is the health check status
                          type: string
                      required:
                      - name
                      - status
                      type: object
                    type: array
                  healthScore:
                    description: HealthScore represents overall health score (0.0-1.0)
                    type: number
                  lastCheckTime:
                    description: LastCheckTime is the last health check time
                    format: date-time
                    type: string
                  overallStatus:
                    description: OverallStatus is the overall health status
                    type: string
                required:
                - overallStatus
                type: object
              lastSyncTime:
                description: LastSyncTime indicates last synchronization time
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation observed
                format: int64
                type: integer
              phase:
                description: Phase represents the current deployment phase
                type: string
              resourceStatus:
                description: ResourceStatus contains status of deployed resources
                items:
                  description: DeployedResourceStatus contains status of a deployed
                    resource
                  properties:
                    apiVersion:
                      description: APIVersion of the resource
                      type: string
                    createdAt:
                      description: CreatedAt is the creation time
                      format: date-time
                      type: string
                    health:
                      description: Health is the resource health
                      type: string
                    kind:
                      description: Kind of the resource
                      type: string
                    message:
                      description: Message contains status message
                      type: string
                    name:
                      description: Name of the resource
                      type: string
                    namespace:
                      description: Namespace of the resource
                      type: string
                    status:
                      description: Status is the resource status
                      type: string
                    syncWave:
                      description: SyncWave is the sync wave of the resource
                      type: integer
                    uid:
                      description: UID of the resource
                      type: string
                  required:
                  - apiVersion
                  - kind
                  - name
                  - status
                  type: object
                type: array
              retryCount:
                description: RetryCount tracks retry attempts
                format: int32
                type: integer
              rollbackInfo:
                description: RollbackInfo contains rollback information
                properties:
                  completedAt:
                    description: CompletedAt is the rollback completion time
                    format: date-time
                    type: string
                  initiated:
                    description: Initiated indicates if rollback was initiated
                    type: boolean
                  initiatedAt:
                    description: InitiatedAt is the rollback initiation time
                    format: date-time
                    type: string
                  originalRevision:
                    description: OriginalRevision is the original revision
                    type: string
                  reason:
                    description: Reason for rollback
                    type: string
                  status:
                    description: Status is the rollback status
                    type: string
                  targetRevision:
                    description: TargetRevision is the revision being rolled back
                      to
                    type: string
                required:
                - initiated
                type: object
              syncStatus:
                description: SyncStatus contains synchronization status
                properties:
                  comparedTo:
                    description: ComparedTo contains comparison information
                    properties:
                      destination:
                        description: Destination contains destination information
                        properties:
                          namespace:
                            description: Namespace is the target namespace
                            type: string
                          server:
                            description: Server is the cluster server
                            type: string
                        required:
                        - namespace
                        - server
                        type: object
                      source:
                        description: Source contains source information
                        properties:
                          path:
                            description: Path is the path within the repository
                            type: string
                          repoURL:
                            description: RepoURL is the repository URL
                            type: string
                          targetRevision:
                            description: TargetRevision is the target revision
                            type: string
                        required:
                        - path
                        - repoURL
                        - targetRevision
                        type: object
                    required:
                    - destination
                    - source
                    type: object
                  health:
                    description: Health is the overall health status
                    type: string
                  resources:
                    description: Resources lists the sync status of resources
                    items:
                      description: ResourceSyncStatus contains resource sync status
                      properties:
                        health:
                          description: Health is the health status
                          type: string
                        kind:
                          description: Kind of the resource
                          type: string
                        message:
                          description: Message contains status message
                          type: string
                        name:
                          description: Name of the resource
                          type: string
                        namespace:
                          description: Namespace of the resource
                          type: string
                        status:
                          description: Status is the sync status
                          type: string
                      required:
                      - kind
                      - name
                      - status
                      type: object
                    type: array
                  revision:
                    description: Revision is the Git revision being synced
                    type: string
                  status:
                    description: Status is the overall sync status
                    type: string
                required:
                - status
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status:
        type: object
        x-kubernetes-preserve-unknown-fields: true
