# Test Environment Configuration for CI Hardening
# This file ensures deterministic test behavior across environments

# Go test configuration
export CGO_ENABLED=1
export GOMAXPROCS=2
export GODEBUG=gocachehash=1
export GO111MODULE=on
export GOTESTSUM_FORMAT=short-verbose

# Timeout configuration
export TEST_TIMEOUT_CEILING=8m
export TEST_GO_TIMEOUT=7m30s

# Test execution configuration
export TEST_COUNT=1
export TEST_PARALLEL=2
export TEST_RACE=1

# Coverage configuration
export TEST_COVERAGE_MODE=atomic
export TEST_COVERAGE_PROFILE=coverage.out

# Environment stability
export GOPROXY=https://proxy.golang.org,direct
export GOSUMDB=sum.golang.org
export GOINSECURE=""

# Test result paths
export TEST_REPORTS_DIR=.test-reports
export TEST_STATUS_FILE=test-status.txt
export COVERAGE_HTML=coverage.html

# CI-specific settings
if [ "${CI:-false}" = "true" ]; then
    export GOTESTSUM_JUNITFILE=${TEST_REPORTS_DIR}/junit.xml
    export TEST_VERBOSE=1
fi

# Platform-specific adjustments
case "$(uname -s)" in
    Linux*)   export TEST_PLATFORM=linux;;
    Darwin*)  export TEST_PLATFORM=darwin;;
    CYGWIN*|MINGW*|MSYS*) export TEST_PLATFORM=windows;;
    *)        export TEST_PLATFORM=unknown;;
esac