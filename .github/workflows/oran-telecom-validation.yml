# =============================================================================
# O-RAN TELECOMMUNICATIONS VALIDATION PIPELINE
# =============================================================================
# Purpose: Specialized validation for O-RAN/5G telecommunications compliance
# Standards: O-RAN WG11, 3GPP TS 29.xxx, ETSI NFV, ITU-T, IETF
# Interfaces: A1 Policy, E2 Service Management, O1 Fault Management
# Security: O-RAN WG11 Security Guidelines, 3GPP SA3 Security Architecture
# =============================================================================

name: O-RAN Telecommunications Validation

on:
  workflow_call:
    inputs:
      compliance_level:
        description: 'O-RAN compliance validation level'
        type: string
        default: 'standard'
        required: false
      interface_validation:
        description: 'O-RAN interface validation (A1,E2,O1)'
        type: string
        default: 'all'
        required: false
      network_function_type:
        description: 'Network function type validation'
        type: string
        default: 'auto-detect'
        required: false
  workflow_dispatch:
    inputs:
      compliance_level:
        description: 'O-RAN compliance validation level'
        type: choice
        options: ['basic', 'standard', 'strict', 'certification-ready']
        default: 'standard'
      interface_validation:
        description: 'O-RAN interfaces to validate'
        type: choice
        options: ['all', 'a1-only', 'e2-only', 'o1-only', 'custom']
        default: 'all'
      network_function_type:
        description: 'Target network function type'
        type: choice
        options: ['auto-detect', 'ran-intelligent-controller', 'cnf-manager', 'vnf-manager', 'orchestrator']
        default: 'auto-detect'
      enable_3gpp_validation:
        description: 'Enable 3GPP standards validation'
        type: boolean
        default: true
      enable_security_validation:
        description: 'Enable O-RAN WG11 security validation'
        type: boolean
        default: true

permissions:
  contents: read
  security-events: write
  actions: read
  checks: write

env:
  COMPLIANCE_LEVEL: ${{ inputs.compliance_level || 'standard' }}
  INTERFACE_VALIDATION: ${{ inputs.interface_validation || 'all' }}
  NETWORK_FUNCTION_TYPE: ${{ inputs.network_function_type || 'auto-detect' }}
  ENABLE_3GPP_VALIDATION: ${{ inputs.enable_3gpp_validation != 'false' }}
  ENABLE_SECURITY_VALIDATION: ${{ inputs.enable_security_validation != 'false' }}
  
  # O-RAN specification versions
  ORAN_WG1_VERSION: "10.00"
  ORAN_WG2_VERSION: "05.00"
  ORAN_WG3_VERSION: "05.00"
  ORAN_WG11_VERSION: "05.00"
  
  # 3GPP release compliance
  THREEGPP_RELEASE: "R17"
  THREEGPP_SA3_VERSION: "17.6.0"

jobs:
  # =============================================================================
  # O-RAN INTERFACE VALIDATION: A1, E2, O1 interface compliance
  # =============================================================================
  oran-interface-validation:
    name: ğŸ“¡ O-RAN Interface Validation
    runs-on: ubuntu-22.04
    timeout-minutes: 20
    outputs:
      a1-compliance: ${{ steps.a1-validation.outputs.compliant }}
      e2-compliance: ${{ steps.e2-validation.outputs.compliant }}
      o1-compliance: ${{ steps.o1-validation.outputs.compliant }}
      interface-summary: ${{ steps.summary.outputs.summary }}
      
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v5
        
      - name: ğŸ”§ Setup Go for O-RAN validation
        uses: actions/setup-go@v5
        with:
          go-version: '1.22.7'
          
      - name: ğŸ“¡ A1 Policy Management Interface Validation
        id: a1-validation
        if: contains(env.INTERFACE_VALIDATION, 'all') || contains(env.INTERFACE_VALIDATION, 'a1')
        run: |
          echo "ğŸ“¡ Validating A1 Policy Management Interface (O-RAN WG2)"
          
          a1_compliant="false"
          a1_issues=0
          
          # Check for A1 interface implementation
          echo "ğŸ” Searching for A1 interface implementation..."
          
          # A1 API endpoint definitions
          if find . -name "*.go" -exec grep -l "a1.*policy\|policy.*a1" {} \; | head -5; then
            echo "  âœ… A1 policy management code found"
          else
            echo "  âš ï¸ No A1 policy management implementation found"
            a1_issues=$((a1_issues + 1))
          fi
          
          # A1 REST API compliance (OpenAPI/Swagger)
          if find . -name "*.yaml" -o -name "*.json" -exec grep -l "a1.*api\|/a1/" {} \; | head -3; then
            echo "  âœ… A1 API specifications found"
          else
            echo "  âš ï¸ A1 API specifications missing"
            a1_issues=$((a1_issues + 1))
          fi
          
          # Policy schema validation
          if find . -name "*.go" -exec grep -l "PolicyType\|PolicySchema" {} \; | head -3; then
            echo "  âœ… Policy schema definitions found"
          else
            echo "  âš ï¸ Policy schema definitions missing"
            a1_issues=$((a1_issues + 1))
          fi
          
          # A1 interface message patterns
          if find . -name "*.go" -exec grep -l "PUT.*policy\|GET.*policy\|DELETE.*policy" {} \; | head -3; then
            echo "  âœ… A1 REST interface patterns found"
          else
            echo "  âš ï¸ A1 REST interface patterns missing"
            a1_issues=$((a1_issues + 1))
          fi
          
          # Determine A1 compliance
          if [[ $a1_issues -eq 0 ]]; then
            a1_compliant="true"
            echo "âœ… A1 interface: COMPLIANT"
          elif [[ $a1_issues -le 2 ]]; then
            a1_compliant="partial"
            echo "âš ï¸ A1 interface: PARTIALLY COMPLIANT ($a1_issues issues)"
          else
            a1_compliant="false"
            echo "âŒ A1 interface: NON-COMPLIANT ($a1_issues issues)"
          fi
          
          echo "compliant=$a1_compliant" >> $GITHUB_OUTPUT
          echo "issues=$a1_issues" >> $GITHUB_OUTPUT
          
      - name: ğŸ“Š E2 Service Management Interface Validation
        id: e2-validation
        if: contains(env.INTERFACE_VALIDATION, 'all') || contains(env.INTERFACE_VALIDATION, 'e2')
        run: |
          echo "ğŸ“Š Validating E2 Service Management Interface (O-RAN WG3)"
          
          e2_compliant="false"
          e2_issues=0
          
          # Check for E2 interface implementation
          echo "ğŸ” Searching for E2 interface implementation..."
          
          # E2 service model definitions
          if find . -name "*.go" -exec grep -l "e2.*service\|service.*e2\|E2SM" {} \; | head -5; then
            echo "  âœ… E2 service model implementation found"
          else
            echo "  âš ï¸ No E2 service model implementation found"
            e2_issues=$((e2_issues + 1))
          fi
          
          # KPM (Key Performance Measurement) service model
          if find . -name "*.go" -exec grep -l "KPM\|kpm\|measurement" {} \; | head -3; then
            echo "  âœ… KPM service model found"
          else
            echo "  âš ï¸ KPM service model missing"
            e2_issues=$((e2_issues + 1))
          fi
          
          # E2 node management
          if find . -name "*.go" -exec grep -l "E2Node\|e2node\|RanFunction" {} \; | head -3; then
            echo "  âœ… E2 node management found"
          else
            echo "  âš ï¸ E2 node management missing"
            e2_issues=$((e2_issues + 1))
          fi
          
          # E2AP (E2 Application Protocol) patterns
          if find . -name "*.go" -exec grep -l "E2AP\|e2ap\|subscription\|indication" {} \; | head -3; then
            echo "  âœ… E2AP protocol patterns found"
          else
            echo "  âš ï¸ E2AP protocol patterns missing"
            e2_issues=$((e2_issues + 1))
          fi
          
          # Determine E2 compliance
          if [[ $e2_issues -eq 0 ]]; then
            e2_compliant="true"
            echo "âœ… E2 interface: COMPLIANT"
          elif [[ $e2_issues -le 2 ]]; then
            e2_compliant="partial"
            echo "âš ï¸ E2 interface: PARTIALLY COMPLIANT ($e2_issues issues)"
          else
            e2_compliant="false"
            echo "âŒ E2 interface: NON-COMPLIANT ($e2_issues issues)"
          fi
          
          echo "compliant=$e2_compliant" >> $GITHUB_OUTPUT
          echo "issues=$e2_issues" >> $GITHUB_OUTPUT
          
      - name: ğŸš¨ O1 Fault Management Interface Validation
        id: o1-validation
        if: contains(env.INTERFACE_VALIDATION, 'all') || contains(env.INTERFACE_VALIDATION, 'o1')
        run: |
          echo "ğŸš¨ Validating O1 Fault Management Interface (O-RAN WG10)"
          
          o1_compliant="false"
          o1_issues=0
          
          # Check for O1 interface implementation
          echo "ğŸ” Searching for O1 interface implementation..."
          
          # VES (Virtual Event Streaming) implementation
          if find . -name "*.go" -exec grep -l "VES\|ves\|event.*streaming" {} \; | head -5; then
            echo "  âœ… VES event streaming implementation found"
          else
            echo "  âš ï¸ No VES event streaming implementation found"
            o1_issues=$((o1_issues + 1))
          fi
          
          # Fault management and alarms
          if find . -name "*.go" -exec grep -l "fault\|alarm\|notification" {} \; | head -3; then
            echo "  âœ… Fault management implementation found"
          else
            echo "  âš ï¸ Fault management implementation missing"
            o1_issues=$((o1_issues + 1))
          fi
          
          # Performance monitoring
          if find . -name "*.go" -exec grep -l "performance\|monitoring\|metrics" {} \; | head -3; then
            echo "  âœ… Performance monitoring found"
          else
            echo "  âš ï¸ Performance monitoring missing"
            o1_issues=$((o1_issues + 1))
          fi
          
          # NETCONF/YANG model support
          if find . -name "*.go" -exec grep -l "NETCONF\|netconf\|YANG\|yang" {} \; | head -3; then
            echo "  âœ… NETCONF/YANG model support found"
          else
            echo "  âš ï¸ NETCONF/YANG model support missing (optional)"
          fi
          
          # Determine O1 compliance
          if [[ $o1_issues -eq 0 ]]; then
            o1_compliant="true"
            echo "âœ… O1 interface: COMPLIANT"
          elif [[ $o1_issues -le 2 ]]; then
            o1_compliant="partial"
            echo "âš ï¸ O1 interface: PARTIALLY COMPLIANT ($o1_issues issues)"
          else
            o1_compliant="false"
            echo "âŒ O1 interface: NON-COMPLIANT ($o1_issues issues)"
          fi
          
          echo "compliant=$o1_compliant" >> $GITHUB_OUTPUT
          echo "issues=$o1_issues" >> $GITHUB_OUTPUT
          
      - name: ğŸ“‹ Generate Interface Compliance Summary
        id: summary
        run: |
          echo "ğŸ“‹ Generating O-RAN interface compliance summary..."
          
          # Collect results
          A1_STATUS="${{ steps.a1-validation.outputs.compliant || 'skipped' }}"
          E2_STATUS="${{ steps.e2-validation.outputs.compliant || 'skipped' }}"
          O1_STATUS="${{ steps.o1-validation.outputs.compliant || 'skipped' }}"
          
          # Create summary JSON
          summary='{
            "a1_policy": {
              "status": "'$A1_STATUS'",
              "issues": "'${{ steps.a1-validation.outputs.issues || '0' }}'"
            },
            "e2_service": {
              "status": "'$E2_STATUS'",
              "issues": "'${{ steps.e2-validation.outputs.issues || '0' }}'"
            },
            "o1_fault": {
              "status": "'$O1_STATUS'",
              "issues": "'${{ steps.o1-validation.outputs.issues || '0' }}'"
            },
            "overall_compliance": "pending"
          }'
          
          # Determine overall compliance
          compliant_count=0
          total_interfaces=0
          
          for status in "$A1_STATUS" "$E2_STATUS" "$O1_STATUS"; do
            if [[ "$status" != "skipped" ]]; then
              total_interfaces=$((total_interfaces + 1))
              if [[ "$status" == "true" ]]; then
                compliant_count=$((compliant_count + 1))
              fi
            fi
          done
          
          if [[ $total_interfaces -eq 0 ]]; then
            overall="no-interfaces"
          elif [[ $compliant_count -eq $total_interfaces ]]; then
            overall="compliant"
          elif [[ $compliant_count -gt 0 ]]; then
            overall="partial"
          else
            overall="non-compliant"
          fi
          
          summary=$(echo "$summary" | jq --arg overall "$overall" '.overall_compliance = $overall')
          
          echo "summary=$summary" >> $GITHUB_OUTPUT
          echo "ğŸ“Š Interface validation complete: $overall ($compliant_count/$total_interfaces)"

  # =============================================================================
  # 3GPP STANDARDS VALIDATION: 5G Core network function compliance
  # =============================================================================
  threegpp-standards-validation:
    name: ğŸŒ 3GPP Standards Validation
    runs-on: ubuntu-22.04
    if: inputs.enable_3gpp_validation != 'false'
    timeout-minutes: 15
    outputs:
      nf-compliance: ${{ steps.nf-validation.outputs.compliant }}
      sbi-compliance: ${{ steps.sbi-validation.outputs.compliant }}
      security-compliance: ${{ steps.security-validation.outputs.compliant }}
      
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v5
        
      - name: ğŸŒ 5G Network Function (NF) Validation
        id: nf-validation
        run: |
          echo "ğŸŒ Validating 3GPP 5G Core Network Function compliance"
          
          nf_compliant="false"
          nf_patterns_found=0
          
          # 5G Core NF service registration patterns
          if find . -name "*.go" -exec grep -l "nf-type\|nfType\|NfType" {} \; | head -3; then
            echo "  âœ… 5G NF service registration patterns found"
            nf_patterns_found=$((nf_patterns_found + 1))
          fi
          
          # Network function profiles
          if find . -name "*.go" -exec grep -l "nf-profile\|nfProfile\|NfProfile" {} \; | head -3; then
            echo "  âœ… Network function profile management found"
            nf_patterns_found=$((nf_patterns_found + 1))
          fi
          
          # Service Based Architecture (SBA) patterns
          if find . -name "*.go" -exec grep -l "sbi\|service-based\|ServiceBased" {} \; | head -3; then
            echo "  âœ… Service Based Architecture patterns found"
            nf_patterns_found=$((nf_patterns_found + 1))
          fi
          
          # 5G service operations
          if find . -name "*.go" -exec grep -l "Namf\|Nsmf\|Nausf\|Nudm\|Nudr\|Npcf" {} \; | head -3; then
            echo "  âœ… 5G Core service operations found"
            nf_patterns_found=$((nf_patterns_found + 1))
          fi
          
          # Network slicing support
          if find . -name "*.go" -exec grep -l "slice\|nssai\|s-nssai\|NSSAI" {} \; | head -3; then
            echo "  âœ… Network slicing support detected"
            nf_patterns_found=$((nf_patterns_found + 1))
          fi
          
          if [[ $nf_patterns_found -ge 3 ]]; then
            nf_compliant="true"
            echo "âœ… 3GPP 5G NF compliance: COMPLIANT ($nf_patterns_found/5 patterns)"
          elif [[ $nf_patterns_found -ge 1 ]]; then
            nf_compliant="partial"
            echo "âš ï¸ 3GPP 5G NF compliance: PARTIAL ($nf_patterns_found/5 patterns)"
          else
            nf_compliant="false"
            echo "âŒ 3GPP 5G NF compliance: NON-COMPLIANT"
          fi
          
          echo "compliant=$nf_compliant" >> $GITHUB_OUTPUT
          
      - name: ğŸ”— Service Based Interface (SBI) Validation
        id: sbi-validation
        run: |
          echo "ğŸ”— Validating 3GPP Service Based Interface compliance"
          
          sbi_compliant="false"
          sbi_features=0
          
          # HTTP/2 REST API patterns
          if find . -name "*.go" -exec grep -l "http2\|HTTP/2\|REST.*api" {} \; | head -3; then
            echo "  âœ… HTTP/2 REST API support found"
            sbi_features=$((sbi_features + 1))
          fi
          
          # OAuth2 authentication
          if find . -name "*.go" -exec grep -l "oauth\|OAuth\|bearer.*token" {} \; | head -3; then
            echo "  âœ… OAuth2 authentication support found"
            sbi_features=$((sbi_features + 1))
          fi
          
          # JSON data format
          if find . -name "*.go" -exec grep -l "json.*marshal\|json.*unmarshal" {} \; | head -3; then
            echo "  âœ… JSON data format support found"
            sbi_features=$((sbi_features + 1))
          fi
          
          # Service discovery
          if find . -name "*.go" -exec grep -l "service.*discovery\|nrf\|NRF" {} \; | head -3; then
            echo "  âœ… Service discovery mechanisms found"
            sbi_features=$((sbi_features + 1))
          fi
          
          if [[ $sbi_features -ge 3 ]]; then
            sbi_compliant="true"
            echo "âœ… SBI compliance: COMPLIANT ($sbi_features/4 features)"
          elif [[ $sbi_features -ge 1 ]]; then
            sbi_compliant="partial"
            echo "âš ï¸ SBI compliance: PARTIAL ($sbi_features/4 features)"
          else
            sbi_compliant="false"
            echo "âŒ SBI compliance: NON-COMPLIANT"
          fi
          
          echo "compliant=$sbi_compliant" >> $GITHUB_OUTPUT
          
      - name: ğŸ” 3GPP Security Architecture Validation
        id: security-validation
        run: |
          echo "ğŸ” Validating 3GPP SA3 Security Architecture compliance"
          
          security_compliant="false"
          security_features=0
          
          # Authentication and key agreement (AKA)
          if find . -name "*.go" -exec grep -l "aka\|AKA\|authentication" {} \; | head -3; then
            echo "  âœ… Authentication mechanisms found"
            security_features=$((security_features + 1))
          fi
          
          # Security context management
          if find . -name "*.go" -exec grep -l "security.*context\|secc\|SECC" {} \; | head -3; then
            echo "  âœ… Security context management found"
            security_features=$((security_features + 1))
          fi
          
          # Integrity and encryption
          if find . -name "*.go" -exec grep -l "integrity\|encryption\|cipher" {} \; | head -3; then
            echo "  âœ… Integrity and encryption support found"
            security_features=$((security_features + 1))
          fi
          
          # Key management
          if find . -name "*.go" -exec grep -l "key.*management\|kdf\|KDF" {} \; | head -3; then
            echo "  âœ… Key management mechanisms found"
            security_features=$((security_features + 1))
          fi
          
          if [[ $security_features -ge 3 ]]; then
            security_compliant="true"
            echo "âœ… 3GPP Security compliance: COMPLIANT ($security_features/4 features)"
          elif [[ $security_features -ge 1 ]]; then
            security_compliant="partial"
            echo "âš ï¸ 3GPP Security compliance: PARTIAL ($security_features/4 features)"
          else
            security_compliant="false"
            echo "âŒ 3GPP Security compliance: NON-COMPLIANT"
          fi
          
          echo "compliant=$security_compliant" >> $GITHUB_OUTPUT

  # =============================================================================
  # TELECOMMUNICATIONS SECURITY VALIDATION: O-RAN WG11 compliance
  # =============================================================================
  telecom-security-validation:
    name: ğŸ” Telecommunications Security
    runs-on: ubuntu-22.04
    if: inputs.enable_security_validation != 'false'
    timeout-minutes: 18
    outputs:
      oran-wg11-compliance: ${{ steps.oran-security.outputs.compliant }}
      zero-trust-compliance: ${{ steps.zero-trust.outputs.compliant }}
      
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v5
        
      - name: ğŸ” O-RAN WG11 Security Validation
        id: oran-security
        run: |
          echo "ğŸ” Validating O-RAN WG11 security requirements"
          
          oran_security_compliant="false"
          security_controls=0
          
          # Secure inter-node communication
          if find . -name "*.go" -exec grep -l "tls\|TLS\|secure.*communication" {} \; | head -3; then
            echo "  âœ… Secure inter-node communication found"
            security_controls=$((security_controls + 1))
          fi
          
          # Certificate-based authentication
          if find . -name "*.go" -exec grep -l "certificate\|x509\|PKI\|pki" {} \; | head -3; then
            echo "  âœ… Certificate-based authentication found"
            security_controls=$((security_controls + 1))
          fi
          
          # Access control and authorization
          if find . -name "*.go" -exec grep -l "rbac\|RBAC\|authorization\|access.*control" {} \; | head -3; then
            echo "  âœ… Access control mechanisms found"
            security_controls=$((security_controls + 1))
          fi
          
          # Security monitoring and logging
          if find . -name "*.go" -exec grep -l "audit\|security.*log\|monitoring" {} \; | head -3; then
            echo "  âœ… Security monitoring and logging found"
            security_controls=$((security_controls + 1))
          fi
          
          # Data encryption at rest and in transit
          if find . -name "*.go" -exec grep -l "encrypt\|aes\|AES\|crypto" {} \; | head -3; then
            echo "  âœ… Data encryption mechanisms found"
            security_controls=$((security_controls + 1))
          fi
          
          # Secure software deployment
          if find . -name "*.yaml" -o -name "*.yml" -exec grep -l "securityContext\|runAsNonRoot" {} \; | head -3; then
            echo "  âœ… Secure software deployment configurations found"
            security_controls=$((security_controls + 1))
          fi
          
          if [[ $security_controls -ge 5 ]]; then
            oran_security_compliant="true"
            echo "âœ… O-RAN WG11 Security: COMPLIANT ($security_controls/6 controls)"
          elif [[ $security_controls -ge 3 ]]; then
            oran_security_compliant="partial"
            echo "âš ï¸ O-RAN WG11 Security: PARTIAL ($security_controls/6 controls)"
          else
            oran_security_compliant="false"
            echo "âŒ O-RAN WG11 Security: NON-COMPLIANT ($security_controls/6 controls)"
          fi
          
          echo "compliant=$oran_security_compliant" >> $GITHUB_OUTPUT
          
      - name: ğŸ›¡ï¸ Zero Trust Architecture Validation
        id: zero-trust
        run: |
          echo "ğŸ›¡ï¸ Validating Zero Trust architecture implementation"
          
          zero_trust_compliant="false"
          zt_principles=0
          
          # Identity and device authentication
          if find . -name "*.go" -exec grep -l "identity\|device.*auth\|mTLS\|mutual.*tls" {} \; | head -3; then
            echo "  âœ… Identity and device authentication found"
            zt_principles=$((zt_principles + 1))
          fi
          
          # Least privilege access
          if find . -name "*.go" -exec grep -l "least.*privilege\|minimal.*permission" {} \; | head -3; then
            echo "  âœ… Least privilege access patterns found"
            zt_principles=$((zt_principles + 1))
          fi
          
          # Micro-segmentation
          if find . -name "*.yaml" -o -name "*.yml" -exec grep -l "networkpolicy\|NetworkPolicy" {} \; | head -3; then
            echo "  âœ… Network micro-segmentation found"
            zt_principles=$((zt_principles + 1))
          fi
          
          # Continuous monitoring
          if find . -name "*.go" -exec grep -l "continuous.*monitor\|real.*time.*monitor" {} \; | head -3; then
            echo "  âœ… Continuous monitoring capabilities found"
            zt_principles=$((zt_principles + 1))
          fi
          
          # Data encryption everywhere
          if find . -name "*.go" -exec grep -l "encrypt.*everywhere\|e2e.*encrypt\|end.*to.*end" {} \; | head -3; then
            echo "  âœ… End-to-end encryption found"
            zt_principles=$((zt_principles + 1))
          fi
          
          if [[ $zt_principles -ge 4 ]]; then
            zero_trust_compliant="true"
            echo "âœ… Zero Trust Architecture: COMPLIANT ($zt_principles/5 principles)"
          elif [[ $zt_principles -ge 2 ]]; then
            zero_trust_compliant="partial"
            echo "âš ï¸ Zero Trust Architecture: PARTIAL ($zt_principles/5 principles)"
          else
            zero_trust_compliant="false"
            echo "âŒ Zero Trust Architecture: NON-COMPLIANT ($zt_principles/5 principles)"
          fi
          
          echo "compliant=$zero_trust_compliant" >> $GITHUB_OUTPUT

  # =============================================================================
  # CNF/VNF LIFECYCLE VALIDATION: Cloud-native and virtualized network functions
  # =============================================================================
  cnf-vnf-lifecycle-validation:
    name: ğŸ”§ CNF/VNF Lifecycle Validation
    runs-on: ubuntu-22.04
    timeout-minutes: 12
    outputs:
      cnf-compliance: ${{ steps.cnf-validation.outputs.compliant }}
      vnf-compliance: ${{ steps.vnf-validation.outputs.compliant }}
      
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v5
        
      - name: â˜ï¸ Cloud-Native Network Function (CNF) Validation
        id: cnf-validation
        run: |
          echo "â˜ï¸ Validating CNF lifecycle management compliance"
          
          cnf_compliant="false"
          cnf_features=0
          
          # Kubernetes-native design
          if find . -name "*.go" -exec grep -l "kubernetes\|k8s\|controller\|operator" {} \; | head -3; then
            echo "  âœ… Kubernetes-native design patterns found"
            cnf_features=$((cnf_features + 1))
          fi
          
          # Helm chart packaging
          if find . -name "Chart.yaml" -o -name "values.yaml" | head -3; then
            echo "  âœ… Helm chart packaging found"
            cnf_features=$((cnf_features + 1))
          fi
          
          # Container lifecycle management
          if find . -name "*.go" -exec grep -l "container\|pod\|deployment" {} \; | head -3; then
            echo "  âœ… Container lifecycle management found"
            cnf_features=$((cnf_features + 1))
          fi
          
          # Service mesh integration
          if find . -name "*.yaml" -o -name "*.yml" -exec grep -l "istio\|linkerd\|service.*mesh" {} \; | head -3; then
            echo "  âœ… Service mesh integration found"
            cnf_features=$((cnf_features + 1))
          fi
          
          # Cloud-native monitoring
          if find . -name "*.yaml" -o -name "*.yml" -exec grep -l "prometheus\|grafana\|jaeger" {} \; | head -3; then
            echo "  âœ… Cloud-native monitoring found"
            cnf_features=$((cnf_features + 1))
          fi
          
          if [[ $cnf_features -ge 4 ]]; then
            cnf_compliant="true"
            echo "âœ… CNF Lifecycle: COMPLIANT ($cnf_features/5 features)"
          elif [[ $cnf_features -ge 2 ]]; then
            cnf_compliant="partial"
            echo "âš ï¸ CNF Lifecycle: PARTIAL ($cnf_features/5 features)"
          else
            cnf_compliant="false"
            echo "âŒ CNF Lifecycle: NON-COMPLIANT ($cnf_features/5 features)"
          fi
          
          echo "compliant=$cnf_compliant" >> $GITHUB_OUTPUT
          
      - name: ğŸ–¥ï¸ Virtual Network Function (VNF) Validation
        id: vnf-validation
        run: |
          echo "ğŸ–¥ï¸ Validating VNF lifecycle management compliance"
          
          vnf_compliant="false"
          vnf_features=0
          
          # VNF descriptor support
          if find . -name "*.go" -exec grep -l "vnfd\|VNFD\|vnf.*descriptor" {} \; | head -3; then
            echo "  âœ… VNF descriptor support found"
            vnf_features=$((vnf_features + 1))
          fi
          
          # ETSI NFV MANO integration
          if find . -name "*.go" -exec grep -l "mano\|MANO\|vnfm\|VNFM" {} \; | head -3; then
            echo "  âœ… ETSI NFV MANO integration found"
            vnf_features=$((vnf_features + 1))
          fi
          
          # VNF lifecycle operations
          if find . -name "*.go" -exec grep -l "instantiate\|scale\|terminate\|vnf.*lifecycle" {} \; | head -3; then
            echo "  âœ… VNF lifecycle operations found"
            vnf_features=$((vnf_features + 1))
          fi
          
          # Performance monitoring
          if find . -name "*.go" -exec grep -l "performance\|vnf.*monitor" {} \; | head -3; then
            echo "  âœ… VNF performance monitoring found"
            vnf_features=$((vnf_features + 1))
          fi
          
          if [[ $vnf_features -ge 3 ]]; then
            vnf_compliant="true"
            echo "âœ… VNF Lifecycle: COMPLIANT ($vnf_features/4 features)"
          elif [[ $vnf_features -ge 1 ]]; then
            vnf_compliant="partial"
            echo "âš ï¸ VNF Lifecycle: PARTIAL ($vnf_features/4 features)"
          else
            vnf_compliant="false"
            echo "âŒ VNF Lifecycle: NON-COMPLIANT ($vnf_features/4 features)"
          fi
          
          echo "compliant=$vnf_compliant" >> $GITHUB_OUTPUT

  # =============================================================================
  # FINAL REPORT: Comprehensive O-RAN telecommunications validation report
  # =============================================================================
  final-telecom-report:
    name: ğŸ“Š O-RAN Validation Report
    runs-on: ubuntu-22.04
    needs: [
      oran-interface-validation,
      threegpp-standards-validation,
      telecom-security-validation,
      cnf-vnf-lifecycle-validation
    ]
    if: always()
    timeout-minutes: 8
    
    steps:
      - name: ğŸ“Š Generate Comprehensive O-RAN Validation Report
        run: |
          echo "# ğŸ“¡ O-RAN Telecommunications Validation Report" > oran-validation-report.md
          echo "" >> oran-validation-report.md
          echo "**Date:** $(date -u +%Y-%m-%dT%H:%M:%SZ)" >> oran-validation-report.md
          echo "**Compliance Level:** ${{ env.COMPLIANCE_LEVEL }}" >> oran-validation-report.md
          echo "**Network Function Type:** ${{ env.NETWORK_FUNCTION_TYPE }}" >> oran-validation-report.md
          echo "**Validation Scope:** ${{ env.INTERFACE_VALIDATION }}" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          echo "## ğŸ¯ Executive Summary" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # O-RAN Interface Compliance Summary
          echo "### O-RAN Interface Compliance" >> oran-validation-report.md
          echo "| Interface | Status | Issues |" >> oran-validation-report.md
          echo "|-----------|--------|--------|" >> oran-validation-report.md
          echo "| A1 Policy | ${{ needs.oran-interface-validation.outputs.a1-compliance || 'skipped' }} | - |" >> oran-validation-report.md
          echo "| E2 Service | ${{ needs.oran-interface-validation.outputs.e2-compliance || 'skipped' }} | - |" >> oran-validation-report.md
          echo "| O1 Fault | ${{ needs.oran-interface-validation.outputs.o1-compliance || 'skipped' }} | - |" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # 3GPP Standards Compliance
          echo "### 3GPP Standards Compliance" >> oran-validation-report.md
          echo "| Component | Status | Notes |" >> oran-validation-report.md
          echo "|-----------|--------|-------|" >> oran-validation-report.md
          echo "| 5G Core NF | ${{ needs.threegpp-standards-validation.outputs.nf-compliance || 'skipped' }} | Network function patterns |" >> oran-validation-report.md
          echo "| Service Based Interface | ${{ needs.threegpp-standards-validation.outputs.sbi-compliance || 'skipped' }} | HTTP/2 REST, OAuth2 |" >> oran-validation-report.md
          echo "| Security Architecture | ${{ needs.threegpp-standards-validation.outputs.security-compliance || 'skipped' }} | SA3 compliance |" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # Security Compliance
          echo "### Security Compliance" >> oran-validation-report.md
          echo "| Framework | Status | Coverage |" >> oran-validation-report.md
          echo "|-----------|--------|----------|" >> oran-validation-report.md
          echo "| O-RAN WG11 | ${{ needs.telecom-security-validation.outputs.oran-wg11-compliance || 'skipped' }} | Security requirements |" >> oran-validation-report.md
          echo "| Zero Trust | ${{ needs.telecom-security-validation.outputs.zero-trust-compliance || 'skipped' }} | Architecture principles |" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # CNF/VNF Lifecycle
          echo "### Network Function Lifecycle" >> oran-validation-report.md
          echo "| Function Type | Status | Features |" >> oran-validation-report.md
          echo "|---------------|--------|----------|" >> oran-validation-report.md
          echo "| CNF (Cloud-Native) | ${{ needs.cnf-vnf-lifecycle-validation.outputs.cnf-compliance || 'skipped' }} | Kubernetes, Helm, Service Mesh |" >> oran-validation-report.md
          echo "| VNF (Virtualized) | ${{ needs.cnf-vnf-lifecycle-validation.outputs.vnf-compliance || 'skipped' }} | ETSI NFV MANO |" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # Overall Assessment
          echo "## ğŸ“ˆ Overall Assessment" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          # Determine overall compliance status
          COMPLIANT_COMPONENTS=0
          TOTAL_COMPONENTS=0
          
          for status in "${{ needs.oran-interface-validation.outputs.a1-compliance }}" \
                       "${{ needs.oran-interface-validation.outputs.e2-compliance }}" \
                       "${{ needs.oran-interface-validation.outputs.o1-compliance }}" \
                       "${{ needs.threegpp-standards-validation.outputs.nf-compliance }}" \
                       "${{ needs.threegpp-standards-validation.outputs.sbi-compliance }}" \
                       "${{ needs.telecom-security-validation.outputs.oran-wg11-compliance }}" \
                       "${{ needs.cnf-vnf-lifecycle-validation.outputs.cnf-compliance }}"; do
            if [[ "$status" != "" && "$status" != "skipped" ]]; then
              TOTAL_COMPONENTS=$((TOTAL_COMPONENTS + 1))
              if [[ "$status" == "true" ]]; then
                COMPLIANT_COMPONENTS=$((COMPLIANT_COMPONENTS + 1))
              fi
            fi
          done
          
          COMPLIANCE_PERCENTAGE=$((COMPLIANT_COMPONENTS * 100 / TOTAL_COMPONENTS))
          
          if [[ $COMPLIANCE_PERCENTAGE -ge 90 ]]; then
            echo "ğŸŸ¢ **EXCELLENT COMPLIANCE** ($COMPLIANCE_PERCENTAGE%)" >> oran-validation-report.md
            echo "Ready for production O-RAN/5G deployment" >> oran-validation-report.md
          elif [[ $COMPLIANCE_PERCENTAGE -ge 75 ]]; then
            echo "ğŸŸ¡ **GOOD COMPLIANCE** ($COMPLIANCE_PERCENTAGE%)" >> oran-validation-report.md
            echo "Suitable for most O-RAN deployment scenarios" >> oran-validation-report.md
          elif [[ $COMPLIANCE_PERCENTAGE -ge 50 ]]; then
            echo "ğŸŸ  **MODERATE COMPLIANCE** ($COMPLIANCE_PERCENTAGE%)" >> oran-validation-report.md
            echo "Additional development needed for full O-RAN compliance" >> oran-validation-report.md
          else
            echo "ğŸ”´ **LOW COMPLIANCE** ($COMPLIANCE_PERCENTAGE%)" >> oran-validation-report.md
            echo "Significant development required for O-RAN compliance" >> oran-validation-report.md
          fi
          
          echo "" >> oran-validation-report.md
          
          # Recommendations
          echo "## ğŸ’¡ Recommendations" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          
          if [[ "${{ needs.oran-interface-validation.outputs.a1-compliance }}" != "true" ]]; then
            echo "- **A1 Interface**: Implement policy management API following O-RAN WG2 specifications" >> oran-validation-report.md
          fi
          
          if [[ "${{ needs.oran-interface-validation.outputs.e2-compliance }}" != "true" ]]; then
            echo "- **E2 Interface**: Add service management capabilities per O-RAN WG3 guidelines" >> oran-validation-report.md
          fi
          
          if [[ "${{ needs.oran-interface-validation.outputs.o1-compliance }}" != "true" ]]; then
            echo "- **O1 Interface**: Implement fault management and VES event streaming" >> oran-validation-report.md
          fi
          
          if [[ "${{ needs.telecom-security-validation.outputs.oran-wg11-compliance }}" != "true" ]]; then
            echo "- **Security**: Enhance security controls per O-RAN WG11 requirements" >> oran-validation-report.md
          fi
          
          if [[ "${{ needs.cnf-vnf-lifecycle-validation.outputs.cnf-compliance }}" != "true" ]]; then
            echo "- **CNF Lifecycle**: Improve cloud-native patterns and Kubernetes integration" >> oran-validation-report.md
          fi
          
          echo "" >> oran-validation-report.md
          echo "## ğŸ“š Standards References" >> oran-validation-report.md
          echo "- **O-RAN Alliance**: Working Group specifications (WG1-WG11)" >> oran-validation-report.md
          echo "- **3GPP**: Release ${{ env.THREEGPP_RELEASE }} specifications" >> oran-validation-report.md
          echo "- **ETSI NFV**: Network Functions Virtualisation standards" >> oran-validation-report.md
          echo "- **CNCF**: Cloud Native Computing Foundation best practices" >> oran-validation-report.md
          echo "" >> oran-validation-report.md
          echo "---" >> oran-validation-report.md
          echo "_Generated by Nephoran O-RAN Telecommunications Validation Pipeline_" >> oran-validation-report.md
          
      - name: ğŸ“¤ Upload O-RAN Validation Report
        uses: actions/upload-artifact@v4
        with:
          name: oran-telecommunications-validation-report
          path: oran-validation-report.md
          retention-days: 180
          
      - name: ğŸ¯ Final Validation Status
        run: |
          echo "ğŸ¯ O-RAN Telecommunications Validation Complete"
          echo ""
          echo "ğŸ“Š Validation Summary:"
          echo "  - Interface Validation: ${{ needs.oran-interface-validation.result }}"
          echo "  - 3GPP Standards: ${{ needs.threegpp-standards-validation.result }}"
          echo "  - Security Validation: ${{ needs.telecom-security-validation.result }}"
          echo "  - CNF/VNF Lifecycle: ${{ needs.cnf-vnf-lifecycle-validation.result }}"
          echo ""
          
          # Determine if validation passed
          if [[ "${{ needs.oran-interface-validation.result }}" == "success" && \
                "${{ needs.threegpp-standards-validation.result }}" != "failure" && \
                "${{ needs.telecom-security-validation.result }}" != "failure" && \
                "${{ needs.cnf-vnf-lifecycle-validation.result }}" != "failure" ]]; then
            echo "âœ… O-RAN Telecommunications Validation: PASSED"
            echo "ğŸš€ Ready for telecommunications deployment"
          else
            echo "âŒ O-RAN Telecommunications Validation: FAILED"
            echo "ğŸ”§ Review validation report and address compliance gaps"
            exit 1
          fi