name: CI

on:
  workflow_dispatch: {}
  push:
    branches: [ main, integrate/mvp, "feat/**", "chore/**" ]
  pull_request:
    branches: [ main, integrate/mvp ]     # <— 建議只針對被保護分支的 PR

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

# …（中略：generate / build / test / lint / security jobs 不變）

ci-status:
  name: CI Status Check                   # <— 顯示名稱固定（將出現在 Ruleset 清單）
  runs-on: ubuntu-latest
  needs: [generate, build, test, lint, security]
  if: always()
  timeout-minutes: 5
  steps:
    - name: Gate on upstream job results
      shell: bash
      run: |
        echo "Generate: ${{ needs.generate.result }}"
        echo "Build:    ${{ needs.build.result }}"
        echo "Test:     ${{ needs.test.result }}"
        echo "Lint:     ${{ needs.lint.result }}"
        echo "Security: ${{ needs.security.result }}"

        if [[ "${{ needs.generate.result }}" != "success" || \
              "${{ needs.build.result }}"    != "success" || \
              "${{ needs.test.result }}"     != "success" || \
              "${{ needs.lint.result }}"     != "success" || \
              "${{ needs.security.result }}" != "success" ]]; then
          echo "❌ CI Pipeline Failed"
          exit 1
        fi
        echo "✅ CI Pipeline Succeeded"
