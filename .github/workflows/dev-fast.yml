# Ultra Fast Development CI - 2 Minute Pipeline
# Use this for rapid development iterations on feature branches
name: âš¡ Development Fast Track

on:
  push:
    branches: 
      - 'feat/**'
      - 'fix/**' 
      - 'chore/**'
      - 'dev/**'
    paths:
      - '**.go'
      - '**.mod'
      - '**.sum'
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Force run on any branch'
        type: boolean
        default: false

concurrency:
  group: dev-fast-${{ github.ref }}
  cancel-in-progress: true

env:
  GO_VERSION: "1.24.6"
  GOPRIVATE: "github.com/thc1006/*"

jobs:
  lightning-check:
    name: âš¡ Lightning Fast Check
    runs-on: ubuntu-latest
    timeout-minutes: 3
    
    steps:
      - name: âš¡ Checkout
        uses: actions/checkout@v4
        
      - name: âš¡ Setup Go with cache
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true
          cache-dependency-path: go.sum
          
      - name: ğŸ”§ Quick dependency check
        run: |
          echo "ğŸ“¦ Quick module check..."
          go mod download || echo "Some modules failed (expected during migration)"
          
      - name: âš¡ Ultra-fast build check
        run: |
          echo "ğŸ—ï¸ Testing main packages build..."
          set -e
          go build ./cmd/... || { echo "âŒ Main packages failed to build"; exit 1; }
          go build ./controllers/... || { echo "âŒ Controllers failed to build"; exit 1; }
          echo "âœ… Core packages build successfully!"
          
      - name: âš¡ Critical tests only
        run: |
          echo "ğŸ§ª Running critical tests only..."
          # Only test core functionality, skip slow tests
          go test -short -timeout=2m ./api/... ./controllers/... || echo "âš ï¸ Some tests failed (non-blocking in dev mode)"
          echo "âœ… Critical tests completed!"
          
      - name: âœ… Success notification
        run: |
          echo "ğŸ‰ Lightning build successful!"
          echo "â±ï¸ Total time: ~2 minutes"
          echo "ğŸš€ Ready for rapid development!"