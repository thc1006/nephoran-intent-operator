# golangci-lint configuration for Nephoran Intent Operator
# Comprehensive linting with performance optimizations for CI/CD

run:
  timeout: 45m
  go: '1.24'
  tests: true
  build-tags:
    - integration
    - netgo
    - osusergo

linters:
  enable-all: true
  disable:
    # Disable only the most problematic linters
    - unused        # Too many false positives in interface implementations
    - unparam       # Too aggressive for interface implementations
    - dupl          # Too many false positives
    - varnamelen    # Short variable names are OK in Go idioms
    - exhaustive    # Not always needed for non-critical switches

linters-settings:
  errcheck:
    check-type-assertions: false
    check-blank: false
    exclude-functions:
      - io.Copy
      - io.WriteString
      - fmt.Print
      - fmt.Printf
      - fmt.Println
      - fmt.Fprint
      - fmt.Fprintf
      - fmt.Fprintln

  govet:
    enable-all: true
    disable:
      - shadow
      - fieldalignment  # Struct field alignment optimization not critical

  gosec:
    excludes:
      - G104  # Errors unhandled - covered by errcheck
      - G307  # Deferring unsafe method - false positives
      - G601  # Implicit memory aliasing - too many false positives
    # Security settings - strict mode for v1.64.3+
    severity: high
    confidence: medium

  gocritic:
    enabled-tags:
      - diagnostic
      - style
      - performance
    disabled-checks:
      - hugeParam      # Large params are sometimes necessary
      - rangeValCopy   # Range value copies are sometimes OK
      - appendAssign   # Append assignments are clear enough
      - commentedOutCode # Sometimes useful for debugging

  revive:
    rules:
      - name: exported
        disabled: true  # Too many false positives
      - name: var-naming
        disabled: true  # Too strict for some cases
      - name: if-return
        disabled: true  # Sometimes clearer with if
      - name: max-public-structs
        disabled: true  # Not relevant
      - name: cognitive-complexity
        disabled: true  # Sometimes complexity is needed

  staticcheck:
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]

  stylecheck:
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]
    initialisms: ["ACL", "API", "ASCII", "CPU", "CSS", "DNS", "EOF", "GUID", "HTML", 
                  "HTTP", "HTTPS", "ID", "IP", "JSON", "JWT", "LHS", "QPS", "RAM", 
                  "RHS", "RPC", "SLA", "SMTP", "SQL", "SSH", "TCP", "TLS", "TTL", 
                  "UDP", "UI", "UID", "UUID", "URI", "URL", "UTF8", "VM", "XML", 
                  "XMPP", "XSRF", "XSS", "CNF", "VNF", "AMF", "SMF", "UPF", "RIC",
                  "O1", "O2", "E2", "A1", "ORAN", "KPM", "FCAPS", "VES", "LLM", "RAG"]

  prealloc:
    simple: false
    range-loops: false
    for-loops: false

  gci:
    sections:
      - standard
      - default
      - prefix(github.com/thc1006/nephoran-intent-operator)

# Issue handling configuration
issues:
  max-same-issues: 0
  max-issues-per-linter: 0
  
  # Use default exclude patterns (vendor, third_party, etc.)
  exclude-use-default: true

  # Files to exclude from linting
  exclude-files:
    - ".*\\.pb\\.go$"
    - ".*_generated\\.go$"
    - "zz_generated.*.go$"

  # Directories to exclude from linting  
  exclude-dirs:
    - vendor
    - third_party
    - testdata
    - examples
    - docs
    - _examples
    - tools
    - .git
    - bin
    - deployments

  exclude-rules:
    # Exclude test files from certain linters
    - path: "_test\\.go"
      linters:
        - errcheck
        - gosec
        - dupl
        - funlen
        - goconst
        - unparam

    # Exclude generated files
    - path: "_generated\\.go"
      linters:
        - all

    # Exclude certain patterns
    - path: "api/.*\\.go"
      linters:
        - revive
      text: "exported"

    # Allow TODO comments
    - text: "TODO"
      linters:
        - godot

    # Allow large functions in main packages
    - path: "cmd/.*/main\\.go"
      linters:
        - funlen
        - gocyclo
        - gocognit

    # Allow unused parameters in interface implementations
    - path: ".*"
      text: "unused-parameter"
      linters:
        - revive

    # Allow certain gosec issues in non-critical code
    - path: "internal/.*"
      linters:
        - gosec
      text: "G115"

    # Contextcheck exceptions for background workers
    - path: ".*"
      text: "Non-inherited new context"
      linters:
        - contextcheck

  exclude:
    # Common false positives
    - "Error return value of .((Close|Write|Flush|Remove|Rollback)|(.*\\.Wait)) is not checked"
    - "exported (type|method|function|const|var) .* should have comment or be unexported"
    - "should have a package comment"
    - "(comment on exported (method|function|type|const)|should have( a package)? comment|comment should be of the form)"
    - "at least one file in a package should have a package comment"

# Output format configuration
output:
  formats:
    - format: colored-line-number
      path: stdout
    - format: sarif
      path: golangci-lint-report.sarif  
  print-issued-lines: true
  print-linter-name: true
  sort-results: true