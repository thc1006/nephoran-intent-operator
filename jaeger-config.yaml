apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: oran-tracing
  namespace: monitoring
spec:
  strategy: production
  storage:
    type: elasticsearch
    elasticsearch:
      nodeCount: 1
      storage:
        size: 50Gi
        storageClassName: openebs-hostpath
      resources:
        requests:
          cpu: 500m
          memory: 2Gi
        limits:
          cpu: 1000m
          memory: 4Gi
      redundancyPolicy: ZeroRedundancy
  ingress:
    enabled: false
  agent:
    strategy: DaemonSet
    config:
      collector:
        endpoint: oran-tracing-collector:14267
      reporter:
        logSpans: true
        localAgentHostPort: localhost:6832
      sampler:
        type: probabilistic
        param: 0.1
  collector:
    replicas: 2
    maxReplicas: 5
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    options:
      collector:
        num-workers: 50
        queue-size: 2000
        es:
          max-span-age: 168h  # 7 days
          index-prefix: oran-traces
  query:
    replicas: 2
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    options:
      query:
        max-clock-skew-adjustment: 0s
---
apiVersion: v1
kind: Service
metadata:
  name: jaeger-query-lb
  namespace: monitoring
spec:
  type: LoadBalancer
  ports:
  - name: http-query
    port: 16686
    targetPort: 16686
  selector:
    app.kubernetes.io/name: jaeger
    app.kubernetes.io/component: query
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: jaeger-sampling-config
  namespace: monitoring
data:
  sampling_config.json: |
    {
      "default_strategy": {
        "type": "probabilistic",
        "param": 0.1
      },
      "per_service_strategies": [
        {
          "service": "oran-du",
          "type": "probabilistic",
          "param": 0.5
        },
        {
          "service": "oran-cu",
          "type": "probabilistic",
          "param": 0.5
        },
        {
          "service": "ric-e2term",
          "type": "probabilistic",
          "param": 0.8
        },
        {
          "service": "ves-collector",
          "type": "probabilistic",
          "param": 0.3
        },
        {
          "service": "nwdaf-analytics",
          "type": "probabilistic",
          "param": 0.6
        }
      ]
    }